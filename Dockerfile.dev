# [stage 1] **************************************************
FROM ruby:2.6.6-alpine3.12 as gembuilder

# RUN gem install bundler && \
RUN apk add --no-cache --update build-base cmake

# RUN git clone https://github.com/exercism/ruby-test-runner /usr/src/ruby-test-runner && \
#     cd /usr/src/ruby-test-runner && \
#     bundle install

WORKDIR /usr/src/app

COPY Gemfile Gemfile.lock ./
RUN gem install bundler:2.1.4 && \
    bundle install

# [stage 2] **************************************************
FROM ruby:2.6.6-alpine3.12

WORKDIR /usr/src/app

COPY Gemfile Gemfile.lock ./
RUN gem install bundler:2.1.4

COPY --from=gembuilder /usr/local/bundle/ /usr/local/bundle/

ENTRYPOINT ./bin/worker
